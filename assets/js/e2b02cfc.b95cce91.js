"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1756],{6245:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"docs/migration/migration-v3","title":"To ESBoot V3","description":"\u5220\u9664.husky","source":"@site/docs/docs/migration/migration-v3.md","sourceDirName":"docs/migration","slug":"/docs/migration/migration-v3","permalink":"/docs/3.0/docs/migration/migration-v3","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Migration","permalink":"/docs/3.0/category/migration"},"next":{"title":"ChangeLog","permalink":"/docs/3.0/category/changelog"}}');var s=t(6070),o=t(9299);const r={sidebar_position:1},l="To ESBoot V3",d={},a=[{value:"\u5220\u9664.husky",id:"\u5220\u9664husky",level:2},{value:"\u66f4\u65b0Package.json",id:"\u66f4\u65b0packagejson",level:2},{value:"\u66f4\u65b0.esbootrc.ts",id:"\u66f4\u65b0esbootrcts",level:2},{value:"\u4fee\u6539template",id:"\u4fee\u6539template",level:2},{value:"\u66f4\u65b0docs",id:"\u66f4\u65b0docs",level:2},{value:"\u79fb\u9664dumi\u914d\u7f6e\u6587\u4ef6",id:"\u79fb\u9664dumi\u914d\u7f6e\u6587\u4ef6",level:3}];function c(n){const e={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"to-esboot-v3",children:"To ESBoot V3"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5220\u9664husky",children:"\u5220\u9664.husky"}),"\n",(0,s.jsx)(e.p,{children:"\u5220\u9664\u6839\u76ee\u5f55\u7684.husky\u76ee\u5f55"}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u4fdd\u8bc1\u540e\u7eed\u66f4\u65b0\u94a9\u5b50\u7684\u7075\u6d3b\u6027\uff0c\u73b0\u5728\u4f1a\u81ea\u52a8\u521b\u5efa"})}),"\n",(0,s.jsx)(e.h2,{id:"\u66f4\u65b0packagejson",children:"\u66f4\u65b0Package.json"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.em,{children:"package.json"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-diff",children:'{\n  "scripts": {\n-    "postinstall": "esboot postinstall",\n\n+    "prepare": "esboot prepare",\n# \u5982\u679c\u4f60\u4e0d\u9700\u8981webpack\u548cvite\u5207\u6362\uff0c\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e00\u884c\uff0c\u5982\u679c\u7528\u4e86\u9700\u8981\u5355\u72ec\u4e0b\u4e2across-env\n+    "dev:vite": "cross-env ESBOOT_BUNDLER=vite esboot dev",\n  },\n  "dependencies": {\n+    "@dz-web/esboot-browser": "^3.0.0",\n  },\n  "devDependencies": {\n-    "@dz-web/esboot": "^2.15.0",\n-    "@dz-web/esboot-plugin-tailwindcss": "0.2.0",\n-    "@dz-web/esboot-plugin-vitest": "^1.1.7",\n\n+    "@dz-web/esboot": "^3.0.0",\n+    "@dz-web/esboot-bundler-webpack": "^3.0.0",\n+    "@dz-web/esboot-plugin-vitest": "^3.0.0",\n  }\n  "stylelint": {\n    "extends": [\n-      "@dz-web/esboot/config/stylelint"\n\n+      "./node_modules/.cache/esboot/stylelint"\n    ]\n  },\n  "commitlint": {\n    "extends": [\n-      "./node_modules/@dz-web/esboot/config/commitlint/index.js"\n\n+      "./node_modules/.cache/esboot/commitlint"\n    ]\n  },\n-  "prettier": "./node_modules/.cache/esboot/prettier/index.json",\n+  "prettier": "./node_modules/.cache/esboot/prettier",\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u66f4\u65b0esbootrcts",children:"\u66f4\u65b0.esbootrc.ts"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:".esbootrc.ts *"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u6807\u51c6\u7684mp\u914d\u7f6e\u4e3a\u51c6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import { defineConfig, CodeSplittingType } from '@dz-web/esboot';\nimport vitestPlugin from '@dz-web/esboot-plugin-vitest';\nimport tailwindcssPlugin from '@dz-web/esboot-plugin-tailwindcss';\n\nexport default defineConfig((runtimeCfg) => ({\n  plugins: [vitestPlugin(), tailwindcssPlugin()],\n  TSChecker: false,\n  // port: 8081,\n  analyze: false,\n  /**\n   * \u8c03\u8bd5\u5e93\u517c\u5bb9\u6027\u95ee\u9898\u65f6\uff0c\u53ef\u4ee5\u5173\u95edmfsu\n   */\n  mfsu: false,\n  pxtorem: {\n    enable: true,\n    // \u8bbe\u8ba1\u7a3f\u4e3a\u9ed8\u8ba4750, \u6d4f\u89c8\u5668\u4ee5375\u4e3a\u57fa\u51c6\uff0c16px\u662f\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528tailwindcss, 32px\u5bf9\u5e94750px\u8bbe\u8ba1\u7a3f\u4e2d\u768416px\n    rootValue: runtimeCfg.isMobile ? 32 : 16,\n  },\n  extraBabelIncludes: [\n    /tailwind-merge/i,\n    /filter-obj/i,\n    /immer/i,\n    /zustand/i,\n    /query-string/i,\n    /react-intl/i,\n    /common/i,\n    /d3-/i,\n    /@tanstack/i,\n    /@react-spring/i,\n    /@floating-ui/i,\n  ],\n  codeSplitting: {\n    jsStrategy: CodeSplittingType.granularChunks,\n    jsStrategyOptions: {\n      // \u4e3a\u4e86\u63d0\u9ad8\u9996\u5c4f\u901f\u5ea6\uff0c\u6211\u4eec\u628a\u4e00\u4e9b\u975e\u5e38\u975e\u5e38\u5e38\u7528\u7684\u5e93\u6253\u8fdb\u516c\u5171\u4ee3\u7801\u5e93\u91cc, \u4e0d\u5e38\u7528\u7684\u8ba9\u8ddf\u7740\u9875\u9762js\u52a0\u8f7d\uff0c\u4ee5\u514d\u5f71\u54cd\u5927\u90e8\u5206\u5c0f\u9875\u9762\u7684\u52a0\u8f7d\u4e0ejs\u89e3\u6790\u901f\u5ea6\n      frameworkBundles: [\n        // \u4e0d\u8981\u6dfb\u52a0router\u8fdb\u6765\uff0c\u6211\u4eec\u7edd\u5927\u591a\u6570\u9875\u9762\u90fd\u662f\u5d4c\u5165\u5230webview\u4e2d\u7528\u7684\u5c0f\u9875\u9762\uff0c\u4e0d\u9700\u8981router\uff0c\u6240\u4ee5router\u4e0d\u9700\u8981\u6253\u8fdb\u516c\u5171\u4ee3\u7801\u5e93\u91cc\u3002\u4f1a\u5f71\u54cd\u5927\u90e8\u5206\u9875\u9762\u7684\u52a0\u8f7d\u901f\u5ea6\n        '@dz-web/bridge',\n        'dayjs',\n        '@tanstack/react-query',\n        'redux',\n        'redux-thunk',\n        'react-redux',\n        '@reduxjs/toolkit',\n        'zustand',\n        'immer',\n        'lodash',\n        'nanoid',\n        '@dz-web/axios',\n        '@dz-web/axios-middlewares',\n        'axios',\n        'react-intl',\n        '@loadable/component',\n        'classnames',\n        'perfect-scrollbar',\n      ]\n    },\n  },\n  define: {\n    'process.env.isMobile': runtimeCfg.isMobile as any,\n    'process.env.isBrowser': runtimeCfg.isBrowser as any,\n  },\n}));\n\nexport const afterHooks = (cfg) => {\n  console.log(Object.entries(cfg._entry), '<-- cfg');\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4fee\u6539\u540e\u4e3a:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:".esbootrc.ts *"}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["\u5982\u679c\u4f60\u53ea\u9700\u8981\u4f7f\u7528\u5230Bundler-Webpack\u6216\u8005Bundler-Vite\uff0c\u53ea\u4fdd\u7559\u5bf9\u5e94\u7684",(0,s.jsx)(e.code,{children:"getBundlerViteOptions"}),"\u6216\u8005",(0,s.jsx)(e.code,{children:"getBundlerWebpackOptions"}),"\u5373\u53ef"]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import merge from 'lodash/merge';\nimport { defineConfig, PluginHooks, definePlugin, type UserOptions } from '@dz-web/esboot';\nimport {\n  BundlerWebpack,\n  CodeSplittingType as CodeSplittingTypeWebpack,\n  getImportPluginsOfRsuite,\n} from '@dz-web/esboot-bundler-webpack';\nimport { BundlerVite, CodeSplittingType as CodeSplittingTypeVite } from '@dz-web/esboot-bundler-vite';\nimport type { BabelPlugin, BundlerWebpackOptions } from '@dz-web/esboot-bundler-webpack';\nimport type { BundlerViteOptions } from '@dz-web/esboot-bundler-vite';\nimport vitestPlugin from '@dz-web/esboot-plugin-vitest';\nimport docsPlugin from '@dz-web/esboot-plugin-docs';\n\nconst getBundlerViteOptions = (cfg): UserOptions<BundlerViteOptions> => {\n  return {\n    bundler: BundlerVite,\n    bundlerOptions: {\n      codeSplitting: {\n        jsStrategy: CodeSplittingTypeVite.granularChunks,\n        jsStrategyOptions: {\n          frameworkBundles: [\n            '@dz-web/bridge',\n            'dayjs',\n            '@tanstack/react-query',\n            'react-redux',\n            '@reduxjs/toolkit',\n            'zustand',\n            'immer',\n            'lodash',\n            '@dz-web/axios',\n            '@dz-web/axios-middlewares',\n            'axios',\n            'react-intl',\n            '@loadable/component',\n            'classnames',\n          ],\n        },\n      },\n    },\n  };\n};\n\nconst getBundlerWebpackOptions = (cfg): UserOptions<BundlerWebpackOptions> => {\n  const extraBabelPlugins: BabelPlugin[] = [];\n  if (!cfg.isMobile) {\n    extraBabelPlugins.push(getImportPluginsOfRsuite([]));\n  }\n\n  return {\n    bundler: BundlerWebpack,\n    bundlerOptions: {\n      mfsu: false,\n      extraBabelPlugins,\n      extraBabelIncludes: [\n        /filter-obj/i,\n        /immer/i,\n        /query-string/i,\n        /react-intl/i,\n        /d3-/i,\n        /@tanstack/i,\n        /@react-spring/i,\n        /radash/i,\n        /tailwind-merge/i,\n        /@radix-ui/i,\n        /react-router-dom/i,\n        /@floating-ui/i,\n        /zustand/i,\n        /quote-client-s6/i,\n      ],\n      codeSplitting: {\n        jsStrategy: CodeSplittingTypeWebpack.granularChunks,\n        jsStrategyOptions: {\n          // \u4e3a\u4e86\u63d0\u9ad8\u9996\u5c4f\u901f\u5ea6\uff0c\u6211\u4eec\u628a\u4e00\u4e9b\u975e\u5e38\u975e\u5e38\u5e38\u7528\u7684\u5e93\u6253\u8fdb\u516c\u5171\u4ee3\u7801\u5e93\u91cc, \u4e0d\u5e38\u7528\u7684\u8ba9\u8ddf\u7740\u9875\u9762js\u52a0\u8f7d\uff0c\u4ee5\u514d\u5f71\u54cd\u5927\u90e8\u5206\u5c0f\u9875\u9762\u7684\u52a0\u8f7d\u4e0ejs\u89e3\u6790\u901f\u5ea6\n          frameworkBundles: [\n            // \u4e0d\u8981\u6dfb\u52a0router\u8fdb\u6765\uff0c\u6211\u4eec\u7edd\u5927\u591a\u6570\u9875\u9762\u90fd\u662f\u5d4c\u5165\u5230webview\u4e2d\u7528\u7684\u5c0f\u9875\u9762\uff0c\u4e0d\u9700\u8981router\uff0c\u6240\u4ee5router\u4e0d\u9700\u8981\u6253\u8fdb\u516c\u5171\u4ee3\u7801\u5e93\u91cc\u3002\u4f1a\u5f71\u54cd\u5927\u90e8\u5206\u9875\u9762\u7684\u52a0\u8f7d\u901f\u5ea6\n            '@dz-web/bridge',\n            'dayjs',\n            '@tanstack/react-query',\n            'redux',\n            'redux-thunk',\n            'react-redux',\n            '@reduxjs/toolkit',\n            'zustand',\n            'immer',\n            'lodash',\n            'nanoid',\n            '@dz-web/axios',\n            '@dz-web/axios-middlewares',\n            'axios',\n            'react-intl',\n            '@loadable/component',\n            'classnames',\n            'perfect-scrollbar',\n          ],\n        },\n      },\n    },\n  };\n};\n\nexport default defineConfig<BundlerWebpackOptions | BundlerViteOptions>((cfg) => {\n  const bundlerOptions = process.env.ESBOOT_BUNDLER === 'vite' ? getBundlerViteOptions(cfg) : getBundlerWebpackOptions(cfg);\n\n  const config: UserOptions<BundlerWebpackOptions | BundlerViteOptions> = {\n    ...bundlerOptions,\n    jsMinifierOptions: {\n      format: {\n        comments: false,\n      },\n    },\n    px2rem: {\n      enable: true,\n      // \u8bbe\u8ba1\u7a3f\u4e3a\u9ed8\u8ba4750, \u6d4f\u89c8\u5668\u4ee5375\u4e3a\u57fa\u51c6\uff0c16px\u662f\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528tailwindcss, 32px\u5bf9\u5e94750px\u8bbe\u8ba1\u7a3f\u4e2d\u768416px\n      rootValue: cfg.isMobile ? 32 : 16,\n    },\n    define: {\n      'process.env.isMobile': cfg.isMobile as any,\n      'process.env.isBrowser': cfg.isBrowser as any,\n    },\n    plugins: [\n      vitestPlugin(),\n      docsPlugin(),\n      definePlugin({\n        key: 'log',\n        [PluginHooks.afterCompile]: (cfg) => {\n          const { isDev } = cfg;\n          if (!isDev) return;\n\n          console.log(cfg.entry);\n        },\n      }),\n    ],\n  };\n\n  return config;\n});\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u4fee\u6539template",children:"\u4fee\u6539template"}),"\n",(0,s.jsx)(e.p,{children:"\u79fb\u9664\u6587\u4ef6\u4e2d\u7684"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-diff",children:"- <title><%= htmlWebpackPlugin.options.title %></title>\n"})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsx)(e.p,{children:"\u73b0\u5728title\u4f1a\u81ea\u52a8\u751f\u6210\uff0c\u4e0d\u9700\u8981\u5728template\u4e2d\u914d\u7f6e"})}),"\n",(0,s.jsx)(e.h2,{id:"\u66f4\u65b0docs",children:"\u66f4\u65b0docs"}),"\n",(0,s.jsx)(e.h3,{id:"\u79fb\u9664dumi\u914d\u7f6e\u6587\u4ef6",children:"\u79fb\u9664dumi\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,s.jsxs)(e.p,{children:["\u79fb\u9664",(0,s.jsx)(e.code,{children:"docs/docs/.dumirc"}),"\u6587\u4ef6"]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},9299:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>l});var i=t(758);const s={},o=i.createContext(s);function r(n){const e=i.useContext(o);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);